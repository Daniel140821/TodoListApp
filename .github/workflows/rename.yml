name: ğŸ› ï¸ Setup New Project

on:
  workflow_dispatch:
    inputs:
      new_name:
        description: 'New Name (English Only, No Spaces)'
        required: true
        default: 'NewApp'
      new_bundle_id:
        description: 'Bundle ID (English Only)'
        required: true
        default: 'com.example.app'

jobs:
  rename-project:
    runs-on: ubuntu-latest
    # å½»åº•åˆ é™¤ permissions æ¨¡å—ï¼Œä½¿ç”¨é»˜è®¤è®¾ç½®
    
    steps:
      - name: Checkout Code
        uses: actions/checkout@v4

      - name: Rename and Configure
        run: |
          NEW_NAME="${{ inputs.new_name }}"
          NEW_ID="${{ inputs.new_bundle_id }}"
          
          # 1. ç²¾å‡†è·å–æ—§åå­—
          OLD_NAME=$(find . -maxdepth 1 -name "*.xcodeproj" -exec basename {} .xcodeproj \;)
          
          if [ -z "$OLD_NAME" ]; then
            echo "âŒ ä¸¥é‡é”™è¯¯: æ‰¾ä¸åˆ° .xcodeproj æ–‡ä»¶ï¼"
            exit 1
          fi

          echo "âœ… é”å®šæ—§é¡¹ç›®åä¸º: [$OLD_NAME]"
          
          if [ "$OLD_NAME" == "$NEW_NAME" ]; then
            echo "âš ï¸ åå­—ä¸€æ ·ï¼Œä¸éœ€è¦æ”¹ã€‚"
            exit 0
          fi

          # 2. æ”¹æ–‡ä»¶å†…å®¹
          # LC_ALL=C é˜²æ­¢æŠ¥é”™
          LC_ALL=C grep -rIl "$OLD_NAME" . --exclude-dir=.git --exclude-dir=.github | xargs sed -i "s/$OLD_NAME/$NEW_NAME/g"
          
          # 3. æ”¹æ–‡ä»¶å¤¹åå­—
          if [ -d "$OLD_NAME" ]; then mv "$OLD_NAME" "$NEW_NAME"; fi
          if [ -d "$OLD_NAME.xcodeproj" ]; then mv "$OLD_NAME.xcodeproj" "$NEW_NAME.xcodeproj"; fi
          if [ -d "${OLD_NAME}Tests" ]; then mv "${OLD_NAME}Tests" "${NEW_NAME}Tests"; fi
          if [ -d "${OLD_NAME}UITests" ]; then mv "${OLD_NAME}UITests" "${NEW_NAME}UITests"; fi

          # 4. æ›¿æ¢ Bundle ID
          LC_ALL=C grep -rIl "PRODUCT_BUNDLE_IDENTIFIER" . --exclude-dir=.git | xargs sed -i "s/PRODUCT_BUNDLE_IDENTIFIER = .*;/PRODUCT_BUNDLE_IDENTIFIER = $NEW_ID;/g"

      - name: Commit Changes
        run: |
          git config --global user.name "GitHub Action Bot"
          git config --global user.email "action@github.com"
          
          # ğŸ”¥ã€æ ¸å¿ƒå¤§æ‹›ã€‘ğŸ”¥
          # åœ¨æäº¤å‰ï¼Œå¼ºåˆ¶æŠŠ .github æ–‡ä»¶å¤¹è¿˜åŸï¼
          # è¿™æ ·è„šæœ¬å°±ä¸ä¼šæäº¤å¯¹è‡ªå·±æ–‡ä»¶ (rename.yml) çš„ä»»ä½•ä¿®æ”¹
          # GitHub å°±ä¸ä¼šæ‹¦æˆªäº†ï¼
          git checkout .github
          
          git add .
          git commit -m "ğŸš€ åˆå§‹åŒ–é¡¹ç›®: $NEW_NAME"
          git push
